# Руководство по разработке

Это руководство содержит инструкции по настройке локальной среды разработки, запуску тестов и участию в проекте Ordinaut.

## Настройка локальной среды разработки

### Предварительные требования

- Python 3.12+
- Docker и Docker Compose
- Git

### Настройка среды

1.  **Клонируйте репозиторий:**
    ```bash
    git clone https://github.com/yoda-digital/ordinaut.git
    cd ordinaut
    ```

2.  **Создайте виртуальное окружение Python:**
    ```bash
    python3 -m venv .venv
    source .venv/bin/activate
    ```

3.  **Установите зависимости:**
    ```bash
    pip install -r requirements.txt
    pip install -r observability/requirements.txt # для компонентов мониторинга
    ```

4.  **Запустите фоновые службы:**
    Для локальной разработки вам понадобятся запущенные база данных PostgreSQL и сервер Redis. Их можно легко запустить с помощью Docker Compose.
    ```bash
    cd ops/
    docker compose up -d postgres redis
    ```

5.  **Выполните миграции базы данных:**
    Примените начальную схему базы данных.
    ```bash
    psql "$DATABASE_URL" -f ../migrations/version_0001.sql
    ```

### Запуск компонентов по отдельности

При запущенных базе данных и Redis вы можете запускать API-сервер, планировщик и воркеры как отдельные процессы на вашем локальном компьютере.

- **Запуск API-сервера:**
  ```bash
  uvicorn api.main:app --host 0.0.0.0 --port 8080 --reload
  ```

- **Запуск службы планировщика:**
  ```bash
  python scheduler/tick.py
  ```

- **Запуск воркера:**
  ```bash
  python workers/runner.py
  ```

## Фреймворк для тестирования

Ordinaut использует `pytest` для тестирования. Тесты организованы по категориям `unit`, `integration` и `load`.

### Запуск тестов

- **Запустить все тесты:**
  ```bash
  pytest
  ```

- **Запустить определенную категорию:**
  ```bash
  pytest tests/unit/
  ```

- **Запустить с отчетом о покрытии:**
  ```bash
  pytest --cov=ordinaut --cov-report=html
  ```

## Качество и стандарты кода

Мы используем `black` для форматирования кода и `flake8` для линтинга, чтобы обеспечить единый стиль кода.

- **Форматировать код:**
  ```bash
  black .
  ```

- **Проверить на ошибки линтинга:**
  ```bash
  flake8 .
  ```

## Участие в проекте

1.  Создайте ветку для новой функциональности (feature branch) от `main`.
2.  Напишите свой код, включая тесты для новой функциональности.
3.  Убедитесь, что все тесты проходят и линтер не выдает ошибок.
4.  Отправьте Pull Request с четким описанием ваших изменений.