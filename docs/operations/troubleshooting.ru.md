# Устранение неполадок

Это руководство предоставляет решения для распространенных проблем, с которыми вы можете столкнуться при работе с Ordinaut.

## Диагностический контрольный список

При возникновении проблемы начните с этих шагов:

1.  **Проверьте состояние системы:** Запросите основной эндпоинт состояния.
    ```bash
    curl http://localhost:8080/health | jq
    ```
    Ищите любые компоненты, которые не являются `healthy`.

2.  **Проверьте статус контейнеров:**
    ```bash
    docker compose ps
    ```
    Убедитесь, что все сервисы находятся в состоянии `Up` и `healthy`.

3.  **Проверьте журналы сервисов:** Просмотрите журналы конкретного компонента, который, по-видимому, неисправен.
    ```bash
    # Пример: Проверьте журналы воркера
    docker compose logs -f worker
    ```

## Распространенные проблемы

### Задачи не выполняются

- **Симптом:** Вы создаете задачу, но она никогда не выполняется.
- **Решение:**
    1.  **Проверьте очередь `due_work`:** Подключитесь к базе данных PostgreSQL и выполните `SELECT COUNT(*) FROM due_work WHERE run_at <= now();`. Если количество велико, ваши воркеры могут быть перегружены или заблокированы.
    2.  **Проверьте журналы планировщика:** Выполните `docker compose logs scheduler`, чтобы увидеть, правильно ли он вычисляет и ставит в очередь время выполнения.
    3.  **Проверьте статус задачи:** Убедитесь, что задача `active`, а не `paused`, запросив `GET /tasks/{id}`.

### Шаг конвейера завершается сбоем

- **Симптом:** Запуск задачи имеет статус `success: false`.
- **Решение:**
    1.  **Получите детали запуска:** Запросите `GET /runs/{id}` для неудачного запуска.
    2.  **Изучите поле `error`:** Оно будет содержать конкретное сообщение об ошибке, такое как тайм-аут инструмента, ошибка валидации или сбой соединения.
    3.  **Проверьте журналы воркера:** Журналы воркера будут содержать подробную трассировку стека и контекст сбоя.

### Высокое использование ЦП или памяти

- **Симптом:** Система работает медленно или не отвечает.
- **Решение:**
    1.  **Определите узкое место:** Используйте `docker stats`, чтобы увидеть, какой контейнер потребляет больше всего ресурсов.
    2.  **Масштабируйте воркеры:** Если очередь `due_work` постоянно велика, вам может понадобиться больше воркеров. См. [Руководство по развертыванию](deployment.md).
    3.  **Оптимизируйте конвейеры:** Ищите неэффективные шаги в конвейере, которые могут выполнять тяжелые вычисления или большие передачи данных.

### Ошибки подключения к базе данных

- **Симптом:** API или другие сервисы сообщают, что не могут подключиться к базе данных.
- **Решение:**
    1.  **Проверьте контейнер PostgreSQL:** Убедитесь, что контейнер `postgres` запущен и исправен.
    2.  **Проверьте пул соединений:** Эндпоинт `GET /health` предоставляет подробную информацию о состоянии пула соединений с базой данных. Если пул исчерпан, возможно, потребуется увеличить его размер в конфигурации.
    3.  **Проверьте сеть:** Убедитесь, что сеть Docker работает правильно.