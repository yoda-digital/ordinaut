# Краткое руководство

Это руководство проведет вас через создание, планирование и проверку вашего первого автоматизированного рабочего процесса с помощью Ordinaut. Мы создадим задачу, которая запускает простой конвейер каждую минуту.

## 1. Определите задачу

Сначала создайте JSON-файл с именем `my_first_task.json`. Этот файл определяет все о задаче: ее имя, расписание и конвейер для выполнения.

Эта задача запланирована на запуск каждую минуту с использованием выражения cron. Конвейер состоит из двух шагов:
1.  Шаг, который имитирует получение данных и сохраняет результат.
2.  Шаг, который использует вывод первого шага в своем сообщении.

```json
{
  "title": "Моя первая автоматизированная задача",
  "description": "Простая задача, которая запускается каждую минуту.",
  "schedule_kind": "cron",
  "schedule_expr": "* * * * *",
  "timezone": "Europe/Chisinau",
  "payload": {
    "params": {
      "user_name": "Пользователь Ordinaut"
    },
    "pipeline": [
      {
        "id": "get_data",
        "uses": "debug.echo",
        "with": {
          "message": "Привет, ${params.user_name}!",
          "details": {
            "timestamp": "${now}"
          }
        },
        "save_as": "greeting"
      },
      {
        "id": "process_data",
        "uses": "debug.log",
        "with": {
          "message": "Шаг 1 сказал: '${steps.greeting.message}' в ${steps.greeting.details.timestamp}"
        }
      }
    ]
  },
  "created_by": "00000000-0000-0000-0000-000000000001"
}
```

!!! info "Использование инструментов"
    Инструменты `debug.echo` и `debug.log` — это встроенные утилиты для тестирования. `debug.echo` просто возвращает полученные данные, а `debug.log` выводит сообщение в журнал воркера.

## 2. Создайте задачу через API

Когда сервисы Ordinaut запущены, используйте `curl` для отправки определения вашей задачи в API. Это зарегистрирует задачу в системе, и планировщик немедленно ее подхватит.

```bash
curl -X POST http://localhost:8080/tasks \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer your-agent-token" \
  -d @my_first_task.json
```

API ответит уникальным идентификатором вашей новой задачи. **Скопируйте этот ID задачи** для следующего шага.

```json
{
  "id": "a1b2c3d4-e5f6-7890-1234-567890abcdef"
}
```

## 3. Проверьте выполнение

Поскольку задача запланирована на запуск каждую минуту, вы можете наблюдать историю ее выполнения почти сразу.

### Проверьте историю запусков

Подождите минуту, затем используйте эндпоинт `runs` для просмотра истории. Замените `{task-id}` на скопированный вами ID.

```bash
curl "http://localhost:8080/runs?task_id={task-id}&limit=5"
```

Вы увидите ответ в формате JSON со списком недавних запусков. Ищите `"success": true`.

```json
{
  "runs": [
    {
      "id": "...",
      "task_id": "a1b2c3d4-e5f6-7890-1234-567890abcdef",
      "started_at": "2025-08-11T12:01:00.123Z",
      "finished_at": "2025-08-11T12:01:00.456Z",
      "success": true,
      "attempt": 1,
      "duration_ms": 333
    }
  ]
}
```

### Проверьте журналы воркера

Вы также можете увидеть выполнение в реальном времени в журналах воркера. Инструмент `debug.log`, который мы использовали в конвейере, выведет туда свой результат.

```bash
docker compose logs -f worker
```

Каждую минуту вы будете видеть такие записи в журнале:

```
INFO:root:Executing step: process_data
INFO:root:Step process_data log: Step 1 said: 'Hello, Ordinaut User!' at 2025-08-11T12:01:00.123Z
INFO:root:Task a1b2c3d4-e5f6-7890-1234-567890abcdef completed successfully
```

---

Поздравляем! Вы успешно создали и проверили повторяющийся автоматизированный рабочий процесс. Теперь вы можете адаптировать этот процесс для создания более сложных и мощных автоматизаций, определяя различные расписания и конвейеры.
