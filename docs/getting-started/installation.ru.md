# Установка

Ordinaut предназначен для запуска в виде набора контейнерных сервисов с использованием Docker. Этот подход обеспечивает последовательную и воспроизводимую среду как для разработки, так и для производственной эксплуатации.

## Предварительные требования

Перед началом убедитесь, что на вашей системе установлены следующие инструменты:

- **Docker Engine:** Версия 24.0 или новее. [Установить Docker](https://docs.docker.com/engine/install/)
- **Docker Compose:** Входит в состав Docker Desktop или как отдельный плагин. [Установить Docker Compose](https://docs.docker.com/compose/install/)
- **Git:** Для клонирования репозитория. [Установить Git](https://git-scm.com/book/ru/v2/Введение-Установка-Git)
- **cURL:** Инструмент командной строки для выполнения API-запросов, используется для проверки.

## 1. Клонируйте репозиторий

Сначала клонируйте репозиторий Ordinaut с GitHub на ваш локальный компьютер.

```bash
git clone https://github.com/yoda-digital/ordinaut.git
cd ordinaut
```

## 2. Запустите систему

Репозиторий включает в себя удобный скрипт (`start.sh`) и файлы Docker Compose в каталоге `ops/` для управления системой.

```bash
cd ops/
./start.sh dev --build
```

Эта команда выполняет несколько действий:
- Читает файлы `docker-compose.yml` и `docker-compose.dev.yml`.
- Собирает образы Docker для сервисов API, планировщика и воркера.
- Запускает все необходимые контейнеры в правильном порядке.
- Монтирует локальный исходный код в контейнеры для «живой» перезагрузки во время разработки.

### Стек сервисов

При запуске стартового скрипта запускаются следующие сервисы:

- **`postgres`**: База данных PostgreSQL, где хранятся все данные о задачах и состояниях.
- **`redis`**: Сервер Redis, используемый для потоков событий и кэширования.
- **`api`**: Основной сервер FastAPI, который предоставляет REST API на порту `8080`.
- **`scheduler`**: Процесс APScheduler, который вычисляет, когда должны выполняться задачи.
- **`worker`**: Рабочий процесс, который подбирает и выполняет просроченные задачи.

## 3. Проверьте установку

Через минуту все сервисы должны быть запущены и исправны. Вы можете убедиться в этом, проверив статусы контейнеров и запросив эндпоинт состояния.

### Проверьте состояние контейнеров

```bash
docker compose ps
```

Вы должны увидеть все сервисы со статусом `Up (healthy)` или `Up`.

### Запросите API состояния

Используйте `curl` для проверки основного эндпоинта состояния:

```bash
curl http://localhost:8080/health
```

Успешный ответ означает, что API работает и может подключаться к базе данных и Redis:

```json
{
  "status": "healthy",
  "checks": [
    {"name": "database", "status": "healthy"},
    {"name": "redis", "status": "healthy"},
    {"name": "scheduler", "status": "healthy"},
    {"name": "workers", "status": "healthy"}
  ]
}
```

## Следующие шаги

Ваш экземпляр Ordinaut теперь полностью работоспособен в среде разработки.

- **Изучите API:** Откройте интерактивный интерфейс Swagger UI по адресу [http://localhost:8080/docs](http://localhost:8080/docs), чтобы увидеть все доступные эндпоинты.
- **Создайте свою первую задачу:** Следуйте [Краткому руководству](quick-start.md), чтобы запланировать свой первый рабочий процесс.
